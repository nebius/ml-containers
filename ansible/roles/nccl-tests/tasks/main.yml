---

- name: Assert nccl_tests_cuda_version is empty - ({{ nccl_tests_cuda_version }})
  ansible.builtin.assert:
    that:
      - nccl_tests_cuda_version is defined
    fail_msg: >-
      Missing nccl_tests_cuda_version
  tags:
    - nccl-tests

- name: Download nccl-tests archive
  ansible.builtin.get_url:
    url: >-
      {{
        nccl_tests_deb_repo_url ~
        '/nccl_tests_' ~ nccl_tests_cuda_version ~
        '_ubuntu' ~ ansible_distribution_version ~
        '/nccl-tests-perf-' ~ ansible_architecture ~ '.tar.gz'
      }}
    dest: "/tmp/nccl-tests-perf-{{ ansible_architecture }}.tar.gz"
    mode: "0644"
  tags:
    - nccl-tests

- name: Extract nccl-tests archive into /usr/bin
  ansible.builtin.unarchive:
    src: "/tmp/nccl-tests-perf-{{ ansible_architecture }}.tar.gz"
    dest: /usr/bin
    remote_src: true
    mode: "0755"
  tags:
    - nccl-tests
